@model AS_Assessment.DTOs.InventoryItemUpdateDto

<h2>Edit Inventory Item</h2>

<form asp-action="Edit" method="post" id="editInventoryForm">
    <input type="hidden" asp-for="Id" />
    <input type="hidden" asp-for="UserId" />
    <input type="hidden" asp-for="CategoryId" />

    <div class="mb-3">
        <label asp-for="Name" class="form-label"></label>
        <input asp-for="Name" id="Name" class="form-control" />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Quantity" class="form-label"></label>
        <input asp-for="Quantity" id="Quantity" type="number" class="form-control" />
        <span asp-validation-for="Quantity" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="WhatNeeded" class="form-label"></label>
        <input asp-for="WhatNeeded" id="WhatNeeded" class="form-control" />
        <span asp-validation-for="WhatNeeded" class="text-danger"></span>
    </div>

    <button type="button" id="enhanceBtn" class="btn btn-info mb-3">Enhance All with AI</button>
    <button type="submit" class="btn btn-primary">Save</button>
    <a asp-action="Index" class="btn btn-secondary">Cancel</a>
</form>

<div id="aiEnhanceResult" class="mt-3" style="white-space: pre-wrap; background: #f8f9fa; padding: 15px; border-radius: 5px; display:none;"></div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.getElementById("enhanceBtn").addEventListener("click", function () {
            const name = document.getElementById("Name").value;
            const quantity = parseInt(document.getElementById("Quantity").value) || 0;
            const whatNeeded = document.getElementById("WhatNeeded").value;

            // You can also send hidden inputs if needed
            const categoryId = document.querySelector('input[name="CategoryId"]').value;

            const params = new URLSearchParams();
            params.append("name", name);
            params.append("quantity", quantity);
            params.append("whatNeeded", whatNeeded);
            params.append("categoryId", categoryId);

            fetch('/Ai/EnhanceInventoryItem', {
                method: 'POST',
                body: params,
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            })
            .then(res => res.json())
            .then(data => {
                const resultDiv = document.getElementById("aiEnhanceResult");
                if (data.success) {
                    resultDiv.style.display = "block";
                    resultDiv.textContent = data.content;
                } else {
                    alert(data.message);
                }
            })
            .catch(err => alert("Error contacting AI service: " + err));
        });
    </script>
}
